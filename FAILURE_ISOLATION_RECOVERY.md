# ì¥ì•  ê²©ë¦¬ ë° ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ ê°€ì´ë“œ

## ğŸ›¡ï¸ ì¥ì•  ê²©ë¦¬ ë©”ì»¤ë‹ˆì¦˜

### ê²©ë¦¬ ì›ì¹™
ë³¸ ì‹œìŠ¤í…œì˜ í•µì‹¬ ì„¤ê³„ ì›ì¹™ì€ "í•œ ê´‘ê³ ì£¼ì˜ ì‹¤íŒ¨ê°€ ë‹¤ë¥¸ ê´‘ê³ ì£¼ì—ê²Œ ì ˆëŒ€ ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤"ì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë‹¤ì¸µì  ê²©ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

## ğŸ“Š ì¥ì•  ê²©ë¦¬ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ê²©ë¦¬ ê³„ì¸µ êµ¬ì¡°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1ì¸µ: í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬    â”‚ ê° ê´‘ê³ ì£¼ë³„ ë…ë¦½ì ì¸ ë°°ì¹˜ ì‘ì—… ì‹¤í–‰        â”‚
â”‚ 2ì¸µ: ìƒíƒœ ê²©ë¦¬        â”‚ ê°œë³„ ê´‘ê³ ì£¼ì˜ ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ ë…ë¦½ ê´€ë¦¬     â”‚
â”‚ 3ì¸µ: ë°ì´í„° ê²©ë¦¬      â”‚ ê´‘ê³ ì£¼ë³„ ë°ì´í„° í•„í„°ë§ ë° ì²˜ë¦¬           â”‚
â”‚ 4ì¸µ: ì‹œê°„ ê²©ë¦¬        â”‚ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€              â”‚
â”‚ 5ì¸µ: ìì› ê²©ë¦¬        â”‚ ë©”ëª¨ë¦¬/CPU ì‚¬ìš©ëŸ‰ ì œí•œ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš¨ ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ë³„ ëŒ€ì‘ ì „ëµ

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë‹¨ì¼ ê´‘ê³ ì£¼ ë°°ì¹˜ ì‹¤íŒ¨

#### ìƒí™© ì„¤ëª…
```
ì´ˆê¸° ìƒíƒœ:
- ADV001: PENDING (ì •ìƒ)
- ADV002: PENDING (ì •ìƒ)  
- ADV003: PENDING (ì •ìƒ)

T0: ADV001 ë°°ì¹˜ ì‹œì‘ â†’ RUNNING
T1: ADV001 ë°°ì¹˜ ì‹¤íŒ¨ (ë°ì´í„° ì˜¤ë¥˜)
```

#### ê²©ë¦¬ ë° ë³µêµ¬ ê³¼ì •

```java
// 1ë‹¨ê³„: ì¦‰ì‹œ ì‹¤íŒ¨ ê°ì§€ ë° ê¸°ë¡
try {
    executeBatchJob(advertiser); // ADV001 ì‹¤í–‰
} catch (Exception e) {
    // ì‹¤íŒ¨ ì¦‰ì‹œ ê²©ë¦¬ ì²˜ë¦¬
    rotationService.recordBatchFailure("ADV001", e);
}

// 2ë‹¨ê³„: ìƒíƒœ ë³€ê²½ (ë‹¤ë¥¸ ê´‘ê³ ì£¼ì™€ ê²©ë¦¬)
public void recordBatchFailure(String advertiserId, Exception exception) {
    advertiser.recordFailure(); // ADV001ë§Œ FAILED ìƒíƒœë¡œ ë³€ê²½
    advertiser.setFailureCount(failureCount + 1); // ì‹¤íŒ¨ ì¹´ìš´í„° ì¦ê°€
    
    // ë‹¤ë¥¸ ê´‘ê³ ì£¼ëŠ” ì˜í–¥ë°›ì§€ ì•ŠìŒ
    // ADV002, ADV003ì€ ì—¬ì „íˆ PENDING ìƒíƒœ ìœ ì§€
}

// 3ë‹¨ê³„: ë‹¤ìŒ ìˆœí™˜ì—ì„œ ìë™ ì œì™¸
List<Advertiser> eligible = findEligibleForBatch();
// ê²°ê³¼: [ADV002, ADV003] (ADV001 ì œì™¸ë¨)
```

#### ì‹œê°„ë³„ ìƒíƒœ ë³€í™”
```
T0: [ADV001:PENDING, ADV002:PENDING, ADV003:PENDING]
T1: [ADV001:RUNNING, ADV002:PENDING, ADV003:PENDING]
T2: [ADV001:FAILED,  ADV002:PENDING, ADV003:PENDING]  â† ê²©ë¦¬ ì™„ë£Œ
T3: ë‹¤ìŒ ì‚¬ì´í´ì—ì„œ ADV002 ì •ìƒ ì„ íƒ ë° ì‹¤í–‰
T4: [ADV001:FAILED,  ADV002:RUNNING, ADV003:PENDING] â† ë‹¤ë¥¸ ê´‘ê³ ì£¼ ì •ìƒ ì²˜ë¦¬
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë‹¤ì¤‘ ê´‘ê³ ì£¼ ë™ì‹œ ì‹¤íŒ¨

#### ìƒí™© ì„¤ëª…
```
ë„¤íŠ¸ì›Œí¬ ì¥ì• ë¡œ ì¸í•´ ë™ì‹œì— ì—¬ëŸ¬ ê´‘ê³ ì£¼ì˜ ë°°ì¹˜ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°

T0: ADV001, ADV002 ë™ì‹œ ë°°ì¹˜ ì‹œì‘
T1: ë„¤íŠ¸ì›Œí¬ ì¥ì•  ë°œìƒ
T2: ë‘ ë°°ì¹˜ ëª¨ë‘ ì‹¤íŒ¨
```

#### ë…ë¦½ì  ê²©ë¦¬ ì²˜ë¦¬

```java
// ê° ê´‘ê³ ì£¼ë³„ë¡œ ë…ë¦½ì ì¸ ì‹¤íŒ¨ ì²˜ë¦¬
CompletableFuture<Void> batch1 = CompletableFuture.runAsync(() -> {
    try {
        executeBatchJob(adv001);
    } catch (Exception e) {
        rotationService.recordBatchFailure("ADV001", e); // ADV001ë§Œ ê²©ë¦¬
    }
});

CompletableFuture<Void> batch2 = CompletableFuture.runAsync(() -> {
    try {
        executeBatchJob(adv002);
    } catch (Exception e) {
        rotationService.recordBatchFailure("ADV002", e); // ADV002ë§Œ ê²©ë¦¬
    }
});

// ê°ê° ë…ë¦½ì ìœ¼ë¡œ íƒ€ì„ì•„ì›ƒ ë° ì‹¤íŒ¨ ì²˜ë¦¬
```

#### ê²©ë¦¬ ê²°ê³¼
```
ì¥ì•  ì „: [ADV001:RUNNING, ADV002:RUNNING, ADV003:PENDING, ADV004:PENDING]
ì¥ì•  í›„: [ADV001:FAILED,  ADV002:FAILED,  ADV003:PENDING, ADV004:PENDING]

ë‹¤ìŒ ìˆœí™˜ ëŒ€ìƒ: [ADV003, ADV004] â† ì •ìƒ ê´‘ê³ ì£¼ë§Œ ê³„ì† ì²˜ë¦¬
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¸í•œ ì¥ì• 

#### ìƒí™© ì„¤ëª…
```
ADV001ì˜ ë°°ì¹˜ ì‘ì—…ì´ 5ë¶„ íƒ€ì„ì•„ì›ƒì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš°
```

#### íƒ€ì„ì•„ì›ƒ ê²©ë¦¬ ë©”ì»¤ë‹ˆì¦˜

```java
// íƒ€ì„ì•„ì›ƒ ì„¤ì • ë° ê°•ì œ ì¢…ë£Œ
try {
    batchExecution.get(5, TimeUnit.MINUTES);
} catch (TimeoutException e) {
    log.error("ê´‘ê³ ì£¼ {} ë°°ì¹˜ ì‘ì—… íƒ€ì„ì•„ì›ƒ", advertiserId);
    
    // 1. ì¦‰ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬ (ë‹¤ë¥¸ ê´‘ê³ ì£¼ ì˜í–¥ ì—†ìŒ)
    rotationService.recordBatchFailure(advertiserId, e);
    
    // 2. ê°•ì œ ì¢…ë£Œë¡œ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ë³´í˜¸
    batchExecution.cancel(true);
    
    // 3. ë‹¤ìŒ ìˆœí™˜ì€ ì •ìƒ ì§„í–‰
}
```

#### íƒ€ì„ì•„ì›ƒ ê²©ë¦¬ íš¨ê³¼
```
T0: ADV001 ë°°ì¹˜ ì‹œì‘ (5ë¶„ íƒ€ì„ì•„ì›ƒ ì„¤ì •)
T1~T4: ì •ìƒ ì²˜ë¦¬ ì‹œê°„
T5: 5ë¶„ íƒ€ì„ì•„ì›ƒ ë„ë‹¬
    â”œâ”€ ADV001 ê°•ì œ ì¢…ë£Œ ë° FAILED ìƒíƒœ ë³€ê²½
    â”œâ”€ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì¦‰ì‹œ íšŒìˆ˜
    â””â”€ ë‹¤ë¥¸ ê´‘ê³ ì£¼ ì²˜ë¦¬ì—ëŠ” ì „í˜€ ì˜í–¥ ì—†ìŒ

T6: ë‹¤ìŒ ì‚¬ì´í´ì—ì„œ ADV002 ì •ìƒ ì„ íƒ
```

## ğŸ”§ ìë™ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜

### 1. ì ì§„ì  ë³µêµ¬ ì „ëµ

```java
// ì‹¤íŒ¨ íšŸìˆ˜ì— ë”°ë¥¸ ì ì§„ì  ë³µêµ¬
public class Advertiser {
    private Integer failureCount = 0;      // í˜„ì¬ ì‹¤íŒ¨ íšŸìˆ˜
    private Integer maxFailures = 3;       // ìµœëŒ€ í—ˆìš© ì‹¤íŒ¨
    
    public boolean isEligibleForBatch() {
        return batchEnabled && 
               status == AdvertiserStatus.ACTIVE && 
               failureCount < maxFailures &&          // â† í•µì‹¬ ì¡°ê±´
               lastBatchStatus != BatchStatus.RUNNING;
    }
    
    public void recordSuccess() {
        this.failureCount = 0;  // ì„±ê³µ ì‹œ ì‹¤íŒ¨ ì¹´ìš´í„° ì™„ì „ ë¦¬ì…‹
        this.lastBatchStatus = BatchStatus.SUCCESS;
    }
    
    public void recordFailure() {
        this.failureCount++;
        if (this.failureCount >= this.maxFailures) {
            this.batchEnabled = false;  // 3íšŒ ì‹¤íŒ¨ ì‹œ ì™„ì „ ë¹„í™œì„±í™”
        }
    }
}
```

### 2. ì‹¤íŒ¨ íŒ¨í„´ë³„ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤

#### íŒ¨í„´ A: ì¼ì‹œì  ì‹¤íŒ¨ (1-2íšŒ)
```
ìƒí™©: ë„¤íŠ¸ì›Œí¬ ì§€ì—°, ì¼ì‹œì  DB ì—°ê²° ë¬¸ì œ
ë³µêµ¬: ìë™ (ë‹¤ìŒ ìˆœí™˜ì—ì„œ ì¬ì‹œë„)

T0: ADV001 ì‹¤íŒ¨ (failureCount: 0â†’1)
T1: ë‹¤ìŒ ìˆœí™˜ì—ì„œ ADV001 ì—¬ì „íˆ eligible
T2: ADV001 ì¬ì‹œë„ â†’ ì„±ê³µ (failureCount: 1â†’0)
```

#### íŒ¨í„´ B: ì§€ì†ì  ì‹¤íŒ¨ (3íšŒ)
```
ìƒí™©: ê´‘ê³ ì£¼ë³„ ë°ì´í„° ë¬¸ì œ, ì„¤ì • ì˜¤ë¥˜
ë³µêµ¬: ìˆ˜ë™ ê°œì… í•„ìš”

T0: ADV001 1ì°¨ ì‹¤íŒ¨ (failureCount: 0â†’1)
T1: ADV001 2ì°¨ ì‹¤íŒ¨ (failureCount: 1â†’2)
T2: ADV001 3ì°¨ ì‹¤íŒ¨ (failureCount: 2â†’3, batchEnabled: trueâ†’false)
T3: ADV001 ì™„ì „ ë¹„í™œì„±í™”, ìˆ˜ë™ ë³µêµ¬ ëŒ€ê¸°
```

### 3. ìŠ¤í…Œì¼ ì‘ì—… ìë™ ì •ë¦¬

```java
// 30ë¶„ ì´ìƒ RUNNING ìƒíƒœì¸ ì‘ì—… ìë™ ì •ë¦¬
@Scheduled(fixedDelay = 300000) // 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
public void healthCheckAndCleanup() {
    List<Advertiser> runningJobs = rotationService.getRunningBatchJobs();
    LocalDateTime cutoffTime = LocalDateTime.now().minusMinutes(30);
    
    for (Advertiser advertiser : runningJobs) {
        if (advertiser.getLastBatchRun() != null && 
            advertiser.getLastBatchRun().isBefore(cutoffTime)) {
            
            // ìŠ¤í…Œì¼ ì‘ì—… ê°ì§€ ë° ìë™ ë³µêµ¬
            log.warn("ìŠ¤í…Œì¼ ì‘ì—… ê°ì§€: {} (30ë¶„ ì´ìƒ RUNNING)", 
                     advertiser.getAdvertiserId());
            
            rotationService.recordBatchFailure(
                advertiser.getAdvertiserId(), 
                new RuntimeException("ìŠ¤í…Œì¼ ì‘ì—… - ì‹œìŠ¤í…œ ì¬ì‹œì‘ìœ¼ë¡œ ì¸í•œ ì •ë¦¬")
            );
        }
    }
}
```

## ğŸ“‹ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ ë§¤ë‰´ì–¼

### ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ 1: ë‹¨ì¼ ê´‘ê³ ì£¼ ìˆ˜ë™ ë³µêµ¬

```bash
#!/bin/bash
# single_advertiser_recovery.sh

ADVERTISER_ID="ADV001"

echo "=== ê´‘ê³ ì£¼ $ADVERTISER_ID ë³µêµ¬ ì‹œì‘ ==="

# 1. í˜„ì¬ ìƒíƒœ í™•ì¸
echo "1. í˜„ì¬ ìƒíƒœ í™•ì¸"
curl -s http://localhost:8080/api/admin/batch/advertiser/$ADVERTISER_ID | jq '.'

# 2. ì‹¤íŒ¨ ì¹´ìš´í„° ë¦¬ì…‹
echo "2. ì‹¤íŒ¨ ì¹´ìš´í„° ë¦¬ì…‹"
curl -s -X POST http://localhost:8080/api/admin/batch/reset/$ADVERTISER_ID

# 3. í…ŒìŠ¤íŠ¸ ë°°ì¹˜ ì‹¤í–‰
echo "3. í…ŒìŠ¤íŠ¸ ë°°ì¹˜ ì‹¤í–‰"
curl -s -X POST http://localhost:8080/api/admin/batch/trigger/$ADVERTISER_ID

# 4. ë³µêµ¬ ê²°ê³¼ í™•ì¸
echo "4. ë³µêµ¬ ê²°ê³¼ í™•ì¸ (10ì´ˆ í›„)"
sleep 10
curl -s http://localhost:8080/api/admin/batch/advertiser/$ADVERTISER_ID | jq '.lastBatchStatus'

echo "=== ë³µêµ¬ ì™„ë£Œ ==="
```

### ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ 2: ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬

```bash
#!/bin/bash
# full_system_recovery.sh

echo "=== ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬ ì‹œì‘ ==="

# 1. ì‹œìŠ¤í…œ ìƒíƒœ ì§„ë‹¨
echo "1. ì‹œìŠ¤í…œ ìƒíƒœ ì§„ë‹¨"
STATUS=$(curl -s http://localhost:8080/api/admin/batch/status)
ELIGIBLE_COUNT=$(echo $STATUS | jq '.eligibleAdvertisers')
echo "ì²˜ë¦¬ ê°€ëŠ¥í•œ ê´‘ê³ ì£¼ ìˆ˜: $ELIGIBLE_COUNT"

if [ "$ELIGIBLE_COUNT" -lt 2 ]; then
    echo "âš ï¸ ê¸´ê¸‰ ë³µêµ¬ í•„ìš”: ì²˜ë¦¬ ê°€ëŠ¥í•œ ê´‘ê³ ì£¼ê°€ ë¶€ì¡±"
    
    # 2. ëª¨ë“  ê´‘ê³ ì£¼ ëª©ë¡ ì¡°íšŒ ë° ë³µêµ¬
    for adv in ADV001 ADV002 ADV003 ADV004 ADV005; do
        echo "ê´‘ê³ ì£¼ $adv ìƒíƒœ í™•ì¸ ì¤‘..."
        
        ADV_STATUS=$(curl -s http://localhost:8080/api/admin/batch/advertiser/$adv)
        BATCH_ENABLED=$(echo $ADV_STATUS | jq '.batchEnabled')
        FAILURE_COUNT=$(echo $ADV_STATUS | jq '.failureCount')
        
        if [ "$BATCH_ENABLED" = "false" ] || [ "$FAILURE_COUNT" -gt 0 ]; then
            echo "ê´‘ê³ ì£¼ $adv ë³µêµ¬ ì¤‘... (ì‹¤íŒ¨íšŸìˆ˜: $FAILURE_COUNT)"
            curl -s -X POST http://localhost:8080/api/admin/batch/reset/$adv
            
            # ë³µêµ¬ í›„ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸
            echo "ë³µêµ¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰..."
            curl -s -X POST http://localhost:8080/api/admin/batch/trigger/$adv &
            
            sleep 2  # ë‹¤ìŒ ê´‘ê³ ì£¼ì™€ ê°„ê²© ë‘ê¸°
        else
            echo "ê´‘ê³ ì£¼ $adv ì •ìƒ ìƒíƒœ"
        fi
    done
    
    # 3. ë³µêµ¬ ê²°ê³¼ ìµœì¢… í™•ì¸
    echo "3. ë³µêµ¬ ê²°ê³¼ í™•ì¸ (30ì´ˆ í›„)"
    sleep 30
    
    NEW_STATUS=$(curl -s http://localhost:8080/api/admin/batch/status)
    NEW_ELIGIBLE_COUNT=$(echo $NEW_STATUS | jq '.eligibleAdvertisers')
    echo "ë³µêµ¬ í›„ ì²˜ë¦¬ ê°€ëŠ¥í•œ ê´‘ê³ ì£¼ ìˆ˜: $NEW_ELIGIBLE_COUNT"
    
    if [ "$NEW_ELIGIBLE_COUNT" -ge 3 ]; then
        echo "âœ… ì‹œìŠ¤í…œ ë³µêµ¬ ì„±ê³µ"
    else
        echo "âŒ ì¶”ê°€ ìˆ˜ë™ ì¡°ì¹˜ í•„ìš”"
    fi
else
    echo "âœ… ì‹œìŠ¤í…œ ì •ìƒ ìƒíƒœ"
fi

echo "=== ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬ ì™„ë£Œ ==="
```

### ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ 3: ë°ì´í„° ì¼ê´€ì„± ë³µêµ¬

```sql
-- ë°ì´í„°ë² ì´ìŠ¤ ì¼ê´€ì„± ì²´í¬ ë° ë³µêµ¬
-- 1. RUNNING ìƒíƒœì¸ë° 30ë¶„ ì´ìƒ ëœ ì‘ì—… ì°¾ê¸°
SELECT advertiser_id, last_batch_run, last_batch_status
FROM advertisers 
WHERE last_batch_status = 'RUNNING' 
  AND last_batch_run < NOW() - INTERVAL 30 MINUTE;

-- 2. ìŠ¤í…Œì¼ ì‘ì—…ì„ FAILEDë¡œ ë³€ê²½
UPDATE advertisers 
SET last_batch_status = 'FAILED',
    failure_count = failure_count + 1,
    batch_enabled = CASE 
        WHEN failure_count + 1 >= max_failures THEN false 
        ELSE batch_enabled 
    END,
    updated_at = NOW()
WHERE last_batch_status = 'RUNNING' 
  AND last_batch_run < NOW() - INTERVAL 30 MINUTE;

-- 3. ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ì€ ì‹¤íŒ¨ ì¹´ìš´íŠ¸ ë¦¬ì…‹ (ê´€ë¦¬ì íŒë‹¨)
UPDATE advertisers 
SET failure_count = 0,
    batch_enabled = true,
    last_batch_status = 'PENDING'
WHERE failure_count >= max_failures 
  AND updated_at < NOW() - INTERVAL 1 DAY;  -- 1ì¼ ì´ìƒ ëœ ì‹¤íŒ¨
```

## ğŸ” ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

### ì‹¤ì‹œê°„ ì¥ì•  ê°ì§€

```java
@Component
public class FailureDetector {
    
    @EventListener
    public void onBatchFailure(BatchFailureEvent event) {
        String advertiserId = event.getAdvertiserId();
        int failureCount = event.getFailureCount();
        
        // ì—°ì† ì‹¤íŒ¨ íŒ¨í„´ ê°ì§€
        if (failureCount >= 2) {
            alertService.sendAlert(
                "ê´‘ê³ ì£¼ " + advertiserId + " ì—°ì† ì‹¤íŒ¨ (" + failureCount + "íšŒ)",
                AlertLevel.WARNING
            );
        }
        
        // ì‹œìŠ¤í…œ ì „ì²´ ê±´ê°•ë„ ì²´í¬
        checkSystemHealth();
    }
    
    private void checkSystemHealth() {
        long eligibleCount = advertiserRepository.countEligibleAdvertisers();
        long totalCount = advertiserRepository.count();
        
        double healthRatio = (double) eligibleCount / totalCount;
        
        if (healthRatio < 0.5) {  // 50% ë¯¸ë§Œì´ ì²˜ë¦¬ ê°€ëŠ¥í•œ ê²½ìš°
            alertService.sendAlert(
                "ì‹œìŠ¤í…œ ê±´ê°•ë„ ì €í•˜: ì²˜ë¦¬ ê°€ëŠ¥í•œ ê´‘ê³ ì£¼ " + eligibleCount + "/" + totalCount,
                AlertLevel.CRITICAL
            );
        }
    }
}
```

### ë³µêµ¬ ì„±ê³µë¥  ì¶”ì 

```java
@Component
public class RecoveryMetrics {
    private final Map<String, RecoveryStats> recoveryStats = new ConcurrentHashMap<>();
    
    public void recordRecoveryAttempt(String advertiserId) {
        recoveryStats.computeIfAbsent(advertiserId, k -> new RecoveryStats())
                    .incrementAttempts();
    }
    
    public void recordRecoverySuccess(String advertiserId) {
        recoveryStats.computeIfAbsent(advertiserId, k -> new RecoveryStats())
                    .incrementSuccesses();
    }
    
    public double getRecoverySuccessRate(String advertiserId) {
        RecoveryStats stats = recoveryStats.get(advertiserId);
        if (stats == null || stats.attempts == 0) return 0.0;
        return (double) stats.successes / stats.attempts;
    }
    
    static class RecoveryStats {
        private long attempts = 0;
        private long successes = 0;
        
        void incrementAttempts() { attempts++; }
        void incrementSuccesses() { successes++; }
    }
}
```

ì´ í¬ê´„ì ì¸ ì¥ì•  ê²©ë¦¬ ë° ë³µêµ¬ ê°€ì´ë“œë¥¼ í†µí•´, ì‹œìŠ¤í…œ ìš´ì˜ìëŠ” ì–´ë–¤ ì¥ì•  ìƒí™©ì—ì„œë„ ì‹ ì†í•˜ê³  ì •í™•í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì‹œë‚˜ë¦¬ì˜¤ë³„ë¡œ ìë™í™”ëœ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ê³¼ ìˆ˜ë™ ê°œì… ì ˆì°¨ê°€ ëª¨ë‘ ì¤€ë¹„ë˜ì–´ ìˆì–´, ìµœëŒ€í•œ ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ì •ìƒ ìš´ì˜ì„ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.